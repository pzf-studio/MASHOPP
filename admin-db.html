<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Å –ë–∞–∑–æ–π –î–∞–Ω–Ω—ã—Ö - MA Furniture</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="admin-db.css">
    <script src="admin-auth.js"></script>
</head>
<body>

    <div id="pageLoading" class="page-loading">
        <div style="text-align: center;">
            <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 1rem;"></i>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ —Å –ë–∞–∑–æ–π –î–∞–Ω–Ω—ã—Ö...</p>
        </div>
    </div>

    <main class="main-container">
        <div class="container">
            <div class="admin-panel">
                <div class="admin-header">
                    <div>
                        <h1 class="admin-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏ 
                            <span class="db-status" id="dbStatus">–ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö</span>
                        </h1>
                        <small id="productCounter">–¢–æ–≤–∞—Ä–æ–≤: 0/0</small>
                    </div>
                    <div class="admin-actions">
                        <!-- –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É -->
                        <div class="quick-search">
                            <input type="text" id="quickSearchInput" placeholder="–ê—Ä—Ç–∏–∫—É–ª...">
                            <button class="btn btn-outline" id="quickSearchBtn">
                                <i class="fas fa-search"></i> –ù–∞–π—Ç–∏
                            </button>
                        </div>
                        
                        <button class="btn btn-primary" id="addProductBtn">
                            <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
                        </button>
                        <button class="btn btn-outline" id="refreshBtn">
                            <i class="fas fa-sync"></i> –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                        <button class="btn btn-migrate" id="migrateDataBtn">
                            <i class="fas fa-database"></i> –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
                        </button>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="admin-tabs">
                    <button class="admin-tab active" data-tab="products">–¢–æ–≤–∞—Ä—ã</button>
                    <button class="admin-tab" data-tab="sections">–†–∞–∑–¥–µ–ª—ã</button>
                    <button class="admin-tab" data-tab="orders">–ó–∞–∫–∞–∑—ã</button>
                    <button class="admin-tab" data-tab="statistics">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                </div>

                <!-- Products Tab -->
                <div class="admin-content active" id="productsTab">
                    <div class="table-container">
                        <table class="products-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ –∏ –ê—Ä—Ç–∏–∫—É–ª</th>
                                    <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                    <th>–†–∞–∑–¥–µ–ª</th>
                                    <th>–¶–µ–Ω–∞</th>
                                    <th>–ë–µ–π–¥–∂</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                                <!-- Products will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Sections Tab -->
                <div class="admin-content" id="sectionsTab">
                    <div class="admin-header">
                        <div>
                            <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞–º–∏</h3>
                            <small id="sectionsCounter">–†–∞–∑–¥–µ–ª–æ–≤: 0</small>
                        </div>
                        <div class="admin-actions">
                            <button class="btn btn-primary" id="addSectionBtn">
                                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="products-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–ö–æ–¥</th>
                                    <th>–¢–æ–≤–∞—Ä–æ–≤</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="sectionsTableBody">
                                <!-- Sections will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Orders Tab -->
                <div class="admin-content" id="ordersTab">
                    <div class="empty-state">
                        <i class="fas fa-shopping-bag" style="font-size: 3rem; color: #ddd; margin-bottom: 1rem;"></i>
                        <h3>–†–∞–∑–¥–µ–ª –∑–∞–∫–∞–∑–æ–≤</h3>
                        <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–∞–∫–∞–∑—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π</p>
                    </div>
                </div>

                <!-- Statistics Tab -->
                <div class="admin-content" id="statisticsTab">
                    <div class="empty-state">
                        <i class="fas fa-chart-bar" style="font-size: 3rem; color: #ddd; margin-bottom: 1rem;"></i>
                        <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                        <p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Product Modal -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">
                <i class="fas fa-times"></i>
            </button>
            <div class="modal-body">
                <h2 id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
                <form class="product-form" id="productForm">
                    <input type="hidden" id="productId">
                    
                    <div class="form-group">
                        <label for="productName">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ *</label>
                        <input type="text" id="productName" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="productPrice">–¶–µ–Ω–∞ (‚ÇΩ) *</label>
                            <input type="number" id="productPrice" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="productCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                            <select id="productCategory" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                <option value="pantograph">–ü–∞–Ω—Ç–æ–≥—Ä–∞—Ñ—ã</option>
                                <option value="wardrobe">–ì–∞—Ä–¥–µ—Ä–æ–±–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã</option>
                                <option value="premium">–ü—Ä–µ–º–∏—É–º –∫–æ–ª–ª–µ–∫—Ü–∏—è</option>
                                <option value="kitchen">–ö—É—Ö–æ–Ω–Ω—ã–µ –ª–∏—Ñ—Ç—ã</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="productSection">–†–∞–∑–¥–µ–ª *</label>
                        <select id="productSection" required>
                            <!-- Sections will be loaded dynamically -->
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="productSku">–ê—Ä—Ç–∏–∫—É–ª *</label>
                            <input type="text" id="productSku" required>
                            <small>–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–æ–≤–∞—Ä–∞</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="productStock">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ</label>
                            <input type="number" id="productStock" min="0" value="0">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>–ë–µ–π–¥–∂</label>
                        <div class="badge-selector">
                            <div class="badge-option selected" data-badge="">–ë–µ–∑ –±–µ–π–¥–∂–∞</div>
                            <div class="badge-option" data-badge="–•–∏—Ç –ø—Ä–æ–¥–∞–∂">–•–∏—Ç –ø—Ä–æ–¥–∞–∂</div>
                            <div class="badge-option" data-badge="–ù–æ–≤–∏–Ω–∫–∞">–ù–æ–≤–∏–Ω–∫–∞</div>
                            <div class="badge-option" data-badge="–ê–∫—Ü–∏—è">–ê–∫—Ü–∏—è</div>
                        </div>
                        <input type="hidden" id="productBadge" value="">
                    </div>

                    <div class="form-group">
                        <label for="productFeatures">–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ (–∫–∞–∂–¥–∞—è —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
                        <textarea id="productFeatures" rows="3" placeholder="–í—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã&#10;–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω&#10;–ü—Ä–æ—á–Ω–∞—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="productSpecifications">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–≤ —Ñ–æ—Ä–º–∞—Ç–µ &quot;–ö–ª—é—á: –∑–Ω–∞—á–µ–Ω–∏–µ&quot;)</label>
                        <textarea id="productSpecifications" rows="4" placeholder="–ú–∞—Ç–µ—Ä–∏–∞–ª: –ú–∞—Å—Å–∏–≤ –¥–µ—Ä–µ–≤–∞&#10;–†–∞–∑–º–µ—Ä—ã: 200x90x45 —Å–º&#10;–í–µ—Å: 35 –∫–≥&#10;–¶–≤–µ—Ç: –ù–∞—Ç—É—Ä–∞–ª—å–Ω–æ–µ –¥–µ—Ä–µ–≤–æ"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="productDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="productDescription" rows="4" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="productActive">
                                <input type="checkbox" id="productActive" checked> –ê–∫—Ç–∏–≤–Ω—ã–π —Ç–æ–≤–∞—Ä
                            </label>
                        </div>
                        
                        <div class="form-group">
                            <label for="productFeatured">
                                <input type="checkbox" id="productFeatured"> –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ç–æ–≤–∞—Ä
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="productImages">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ç–æ–≤–∞—Ä–∞</label>
                        <div class="image-upload-container">
                            <div class="image-preview" id="imagePreview">
                                <!-- –ü—Ä–µ–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                            </div>
                            <input type="file" id="productImages" multiple accept="image/*" style="display: none;">
                            <button type="button" class="btn btn-outline" id="uploadImagesBtn">
                                <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ
                            </button>
                            <div class="upload-info">
                                –ú–∞–∫—Å–∏–º—É–º 10 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –¥–æ 10MB –∫–∞–∂–¥–æ–µ
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-cancel" id="cancelBtn">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Section Modal -->
    <div class="modal" id="sectionModal">
        <div class="modal-content">
            <button class="modal-close" id="sectionModalClose">
                <i class="fas fa-times"></i>
            </button>
            <div class="modal-body">
                <h2 id="sectionModalTitle">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª</h2>
                <form class="product-form" id="sectionForm">
                    <input type="hidden" id="sectionId">
                    
                    <div class="form-group">
                        <label for="sectionName">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ *</label>
                        <input type="text" id="sectionName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="sectionCode">–ö–æ–¥ —Ä–∞–∑–¥–µ–ª–∞ (–ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã) *</label>
                        <input type="text" id="sectionCode" required pattern="[a-zA-Z0-9-]+" title="–¢–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –¥–µ—Ñ–∏—Å—ã">
                        <small>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="sectionActive">
                            <input type="checkbox" id="sectionActive" checked> –ê–∫—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–¥–µ–ª
                        </label>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-cancel" id="cancelSectionBtn">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞–∑–¥–µ–ª</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-body">
                <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h3>
                <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?</p>
                <div class="form-actions">
                    <button class="btn btn-cancel" id="cancelDelete">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn btn-delete" id="confirmDelete">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- üîÑ –û–ë–ù–û–í–õ–ï–ù–ù–´–ô Section Confirmation Modal -->
    <div class="modal" id="sectionConfirmModal">
        <div class="modal-content">
            <div class="modal-body">
                <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞</h3>
                <div id="sectionDeleteInfo">
                    <p id="sectionConfirmMessage">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª?</p>
                    <div id="sectionProductsWarning" style="display: none; background: #fff3cd; padding: 10px; border-radius: 4px; margin: 10px 0; border-left: 4px solid #ffc107;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä—ã. –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞ —ç—Ç–∏ —Ç–æ–≤–∞—Ä—ã —Å—Ç–∞–Ω—É—Ç <strong>–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º–∏</strong>.
                    </div>
                </div>
                <div class="form-actions">
                    <button class="btn btn-cancel" id="cancelSectionDelete">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn btn-delete" id="confirmSectionDelete">–£–¥–∞–ª–∏—Ç—å —Ä–∞–∑–¥–µ–ª</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Migration Modal -->
    <div class="modal" id="migrationModal">
        <div class="modal-content">
            <div class="modal-body">
                <h3>–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö</h3>
                <div class="migration-status" id="migrationStatus">
                    <p>–ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö –∏–∑ LocalStorage –≤ –ë–∞–∑—É –î–∞–Ω–Ω—ã—Ö...</p>
                    <div class="progress" style="margin: 1rem 0;">
                        <div id="migrationProgress" style="height: 10px; background: var(--admin-accent); width: 0%; border-radius: 5px; transition: width 0.3s ease;"></div>
                    </div>
                    <p id="migrationDetails">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –º–∏–≥—Ä–∞—Ü–∏–∏...</p>
                </div>
                <div class="form-actions">
                    <button class="btn btn-cancel" id="cancelMigration">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn btn-primary" id="startMigration">–ù–∞—á–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é</button>
                </div>
            </div>
        </div>
    </div>

    <script src="admin-db.js"></script>
    <script>
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏ —Å –ë–î
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ë–î
            const dbStatus = document.getElementById('dbStatus');
            if (dbStatus) {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ë–î
                checkDatabaseConnection();
            }

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
            const migrateBtn = document.getElementById('migrateDataBtn');
            const migrationModal = document.getElementById('migrationModal');
            const startMigrationBtn = document.getElementById('startMigration');
            const cancelMigrationBtn = document.getElementById('cancelMigration');

            if (migrateBtn && migrationModal) {
                migrateBtn.addEventListener('click', function() {
                    migrationModal.classList.add('active');
                });

                cancelMigrationBtn.addEventListener('click', function() {
                    migrationModal.classList.remove('active');
                });

                startMigrationBtn.addEventListener('click', function() {
                    startDataMigration();
                });
            }

            // –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            document.addEventListener('contextmenu', function(e) {
                if (e.target.closest('.admin-panel')) {
                    e.preventDefault();
                }
            });

            document.addEventListener('keydown', function(e) {
                // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
                if (e.key === 'F12' || 
                    (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
                    (e.ctrlKey && e.key === 'u')) {
                    e.preventDefault();
                    return false;
                }
            });
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
        async function checkDatabaseConnection() {
            const dbStatus = document.getElementById('dbStatus');
            if (!dbStatus) return;

            try {
                const response = await fetch('http://localhost:3001/api/stats', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    dbStatus.textContent = '–ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö';
                    dbStatus.className = 'db-status';
                } else {
                    throw new Error('Server error');
                }
            } catch (error) {
                dbStatus.textContent = '–ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö (–û—Ñ–ª–∞–π–Ω)';
                dbStatus.className = 'db-status offline';
                console.warn('Database server not available:', error);
            }
        }

        // –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        async function startDataMigration() {
            const progressBar = document.getElementById('migrationProgress');
            const migrationDetails = document.getElementById('migrationDetails');
            const startMigrationBtn = document.getElementById('startMigration');

            if (!progressBar || !migrationDetails) return;

            try {
                startMigrationBtn.disabled = true;
                startMigrationBtn.textContent = '–ú–∏–≥—Ä–∞—Ü–∏—è...';
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ LocalStorage
                const localProducts = JSON.parse(localStorage.getItem('adminProducts')) || [];
                const localSections = JSON.parse(localStorage.getItem('adminSections')) || [];

                migrationDetails.textContent = `–ù–∞–π–¥–µ–Ω–æ ${localProducts.length} —Ç–æ–≤–∞—Ä–æ–≤ –∏ ${localSections.length} —Ä–∞–∑–¥–µ–ª–æ–≤ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏...`;
                progressBar.style.width = '20%';

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—é
                const response = await fetch('http://localhost:3001/api/migrate-from-localstorage', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        products: localProducts,
                        sections: localSections
                    })
                });

                progressBar.style.width = '60%';

                if (!response.ok) {
                    throw new Error('Migration failed');
                }

                const result = await response.json();
                
                progressBar.style.width = '100%';
                migrationDetails.textContent = `–£—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ ${result.migratedProducts} —Ç–æ–≤–∞—Ä–æ–≤!`;

                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    if (window.adminPanelDB) {
                        window.adminPanelDB.loadData();
                    }
                    document.getElementById('migrationModal').classList.remove('active');
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
                    setTimeout(() => {
                        progressBar.style.width = '0%';
                        startMigrationBtn.disabled = false;
                        startMigrationBtn.textContent = '–ù–∞—á–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é';
                    }, 1000);
                }, 2000);

            } catch (error) {
                console.error('Migration error:', error);
                migrationDetails.textContent = '–û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏: ' + error.message;
                progressBar.style.width = '0%';
                startMigrationBtn.disabled = false;
                startMigrationBtn.textContent = '–ù–∞—á–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é';
            }
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
        window.addEventListener('beforeunload', function() {
            const loadingElement = document.getElementById('pageLoading');
            if (loadingElement) {
                loadingElement.classList.remove('hidden');
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const loadingElement = document.getElementById('pageLoading');
            if (loadingElement) {
                loadingElement.classList.add('hidden');
            }
        });
    </script>
</body>
</html>